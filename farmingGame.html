<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Groundskeeper - Regenerative Farm Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Bitter:wght@400;700&family=Righteous&family=Urbanist:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --earth-dark: #2d1b0e;
            --earth-rich: #4a2c1a;
            --soil-healthy: #6b4423;
            --leaf-green: #4a7c59;
            --wheat-gold: #d4a745;
            --sky-blue: #87ceeb;
            --water-blue: #4a90a4;
            --danger-red: #c44536;
            --dust-gray: #9b8b7e;
            --carbon-black: #1a1a1a;
            --life-green: #7fbc8c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Urbanist', sans-serif;
            background: linear-gradient(135deg, var(--earth-dark) 0%, var(--soil-healthy) 100%);
            color: #f4f1e8;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header */
        #game-header {
            background: rgba(29, 27, 23, 0.95);
            padding: 12px 20px;
            border-bottom: 3px solid var(--wheat-gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }

        #game-title {
            font-family: 'Righteous', cursive;
            font-size: clamp(18px, 4vw, 28px);
            color: var(--wheat-gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
        }

        #resources {
            display: flex;
            gap: clamp(8px, 2vw, 20px);
            font-size: clamp(11px, 2.5vw, 14px);
            font-weight: 700;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(74, 44, 26, 0.6);
            padding: 6px 12px;
            border-radius: 20px;
            border: 2px solid var(--wheat-gold);
            transition: all 0.3s ease;
        }

        .resource:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(212, 167, 69, 0.5);
        }

        .resource-icon {
            font-size: 16px;
        }

        /* Main Game Area */
        #game-main {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* Farm Grid */
        #farm-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #farm-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .plot {
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--dust-gray) 0%, #7a6b5d 100%);
            border: 3px solid var(--earth-rich);
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .plot:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4), inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .plot:active {
            transform: translateY(-2px) scale(1.01);
        }

        .plot.healthy {
            background: linear-gradient(135deg, var(--leaf-green) 0%, #3d6647 100%);
            border-color: var(--life-green);
            animation: pulse-healthy 3s ease-in-out infinite;
        }

        .plot.ready-to-harvest {
            background: linear-gradient(135deg, var(--wheat-gold) 0%, #c49635 100%);
            border-color: var(--wheat-gold);
            animation: pulse-harvest 2s ease-in-out infinite;
        }

        @keyframes pulse-healthy {
            0%, 100% { box-shadow: 0 0 15px rgba(127, 188, 140, 0.4); }
            50% { box-shadow: 0 0 25px rgba(127, 188, 140, 0.7); }
        }

        @keyframes pulse-harvest {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 167, 69, 0.6); }
            50% { box-shadow: 0 0 35px rgba(212, 167, 69, 0.9); }
        }

        .plot-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }

        .plot-icon {
            font-size: clamp(24px, 5vw, 40px);
            margin-bottom: 5px;
            animation: sway 3s ease-in-out infinite;
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        .plot-stats {
            font-size: clamp(9px, 2vw, 11px);
            text-align: center;
            background: rgba(0, 0, 0, 0.6);
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: 700;
        }

        /* Sidebar */
        #sidebar {
            width: clamp(250px, 30vw, 350px);
            background: rgba(45, 27, 14, 0.95);
            border-left: 3px solid var(--wheat-gold);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-section {
            background: rgba(74, 44, 26, 0.5);
            border-radius: 12px;
            padding: 15px;
            border: 2px solid var(--soil-healthy);
        }

        .sidebar-title {
            font-family: 'Bitter', serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--wheat-gold);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-bar {
            margin-bottom: 12px;
        }

        .stat-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .stat-progress {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--life-green) 0%, var(--wheat-gold) 100%);
            transition: width 0.5s ease;
            border-radius: 6px;
        }

        .action-button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, var(--leaf-green) 0%, #3d6647 100%);
            border: 2px solid var(--life-green);
            color: #fff;
            font-weight: 700;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 124, 89, 0.4);
        }

        .action-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(50%);
        }

        .action-button .cost {
            font-size: 11px;
            opacity: 0.9;
        }

        /* Tutorial */
        #tutorial {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .tutorial-content {
            background: linear-gradient(135deg, var(--earth-rich) 0%, var(--soil-healthy) 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            border: 4px solid var(--wheat-gold);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .tutorial-title {
            font-family: 'Righteous', cursive;
            font-size: 36px;
            color: var(--wheat-gold);
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        }

        .tutorial-text {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 30px;
            color: #f4f1e8;
        }

        .start-button {
            padding: 16px 40px;
            background: linear-gradient(135deg, var(--wheat-gold) 0%, #b8903a 100%);
            border: 3px solid var(--wheat-gold);
            color: var(--earth-dark);
            font-weight: 700;
            font-size: 18px;
            border-radius: 12px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(212, 167, 69, 0.4);
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(212, 167, 69, 0.6);
        }

        /* Events Panel */
        #events-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--danger-red) 0%, #a33829 100%);
            padding: 30px;
            border-radius: 16px;
            border: 4px solid var(--wheat-gold);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            z-index: 500;
            max-width: 90%;
            width: 500px;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .event-title {
            font-family: 'Righteous', cursive;
            font-size: 28px;
            margin-bottom: 15px;
            text-align: center;
        }

        .event-description {
            font-size: 16px;
            line-height: 1.6;
            text-align: center;
        }

        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            animation: float-up 2s ease-out forwards;
            z-index: 1000;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                right: -100%;
                top: 0;
                height: 100%;
                width: 80%;
                max-width: 300px;
                transition: right 0.3s ease;
                z-index: 200;
            }

            #sidebar.open {
                right: 0;
            }

            #farm-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 10px;
            }
        }

        /* Info Section */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 12px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
        }

        .info-label {
            font-weight: 500;
            opacity: 0.8;
        }

        .info-value {
            font-weight: 700;
            color: var(--wheat-gold);
        }
    </style>
</head>
<body>
    <!-- Tutorial Screen -->
    <div id="tutorial">
        <div class="tutorial-content">
            <div class="tutorial-title">üå± Groundskeeper üå±</div>
            <div class="tutorial-text">
                <p style="margin-bottom: 15px;">Welcome to your regenerative farm! Build healthy soil through organic matter, microbial life, and water management.</p>
                <p style="margin-bottom: 15px;"><strong>üåæ Your Mission:</strong> Grow crops while sequestering carbon and building biodiversity.</p>
                <p><strong>üí° Tips:</strong> Compost enriches soil, cover crops add life, water keeps everything thriving. Healthy plots glow green!</p>
            </div>
            <button class="start-button" onclick="startGame()">Start Farming</button>
        </div>
    </div>

    <!-- Events Panel -->
    <div id="events-panel">
        <div class="event-title" id="event-title"></div>
        <div class="event-description" id="event-description"></div>
    </div>

    <!-- Main Game Container -->
    <div id="game-container">
        <!-- Header -->
        <div id="game-header">
            <div id="game-title">üå± Groundskeeper</div>
            <div id="resources">
                <div class="resource">
                    <span class="resource-icon">üí∞</span>
                    <span id="money">500</span>
                </div>
                <div class="resource">
                    <span class="resource-icon">üåæ</span>
                    <span id="crops">0</span>
                </div>
                <div class="resource">
                    <span class="resource-icon">üåç</span>
                    <span id="carbon">0</span>
                </div>
            </div>
        </div>

        <!-- Main Game Area -->
        <div id="game-main">
            <!-- Farm Container -->
            <div id="farm-container">
                <div id="farm-grid"></div>
            </div>

            <!-- Sidebar -->
            <div id="sidebar">
                <!-- Farm Health -->
                <div class="sidebar-section">
                    <div class="sidebar-title">üåø Farm Health</div>
                    <div class="stat-bar">
                        <div class="stat-label">
                            <span>Organic Matter</span>
                            <span id="organic-val">50%</span>
                        </div>
                        <div class="stat-progress">
                            <div class="stat-fill" id="organic-bar" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-label">
                            <span>Soil Microbes</span>
                            <span id="microbes-val">50%</span>
                        </div>
                        <div class="stat-progress">
                            <div class="stat-fill" id="microbes-bar" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-label">
                            <span>Soil Moisture</span>
                            <span id="moisture-val">50%</span>
                        </div>
                        <div class="stat-progress">
                            <div class="stat-fill" id="moisture-bar" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-label">
                            <span>Carbon Sequestered</span>
                            <span id="carbon-val">0</span>
                        </div>
                        <div class="stat-progress">
                            <div class="stat-fill" id="carbon-bar" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="sidebar-section">
                    <div class="sidebar-title">‚ö° Actions</div>
                    <button class="action-button" onclick="applyCompost()">
                        üçÇ Add Compost<br>
                        <span class="cost">Cost: $50</span>
                    </button>
                    <button class="action-button" onclick="plantCoverCrop()">
                        üå± Cover Crop<br>
                        <span class="cost">Cost: $30</span>
                    </button>
                    <button class="action-button" onclick="irrigate()">
                        üíß Irrigate All<br>
                        <span class="cost">Cost: $40</span>
                    </button>
                </div>

                <!-- Farm Info -->
                <div class="sidebar-section">
                    <div class="sidebar-title">üìä Farm Stats</div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Season:</span>
                            <span class="info-value" id="season">Spring</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Healthy Plots:</span>
                            <span class="info-value" id="healthy-plots">0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Biodiversity:</span>
                            <span class="info-value" id="biodiversity">Low</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Plots:</span>
                            <span class="info-value">12</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            money: 500,
            crops: 0,
            carbon: 0,
            season: 0,
            plots: [],
            organicMatter: 50,
            microbes: 50,
            moisture: 50,
            carbonScore: 0,
            healthyPlots: 0,
            seasonTimer: null
        };

        const seasons = ['Spring üå∏', 'Summer ‚òÄÔ∏è', 'Fall üçÇ', 'Winter ‚ùÑÔ∏è'];
        const plotIcons = {
            empty: 'üü´',
            seedling: 'üå±',
            growing: 'üåø',
            mature: 'üåæ',
            coverCrop: 'üçÄ'
        };

        const GROWTH_STAGES = {
            SEEDLING: 1,
            GROWING: 2,
            MATURE: 3,
            MAX: 3  // Cap growth at mature stage
        };

        // Initialize Game
        function initGame() {
            // Create 12 plots
            for (let i = 0; i < 12; i++) {
                gameState.plots.push({
                    state: 'empty', // empty, planted, coverCrop
                    organic: 50,
                    microbes: 50,
                    moisture: 50,
                    growthStage: 0,
                    icon: plotIcons.empty
                });
            }

            renderPlots();
            updateUI();
            startSeasonCycle();
        }

        // Render Plots
        function renderPlots() {
            const grid = document.getElementById('farm-grid');
            grid.innerHTML = '';
            gameState.plots.forEach((plot, i) => {
                const plotDiv = document.createElement('div');
                plotDiv.className = 'plot';
                plotDiv.id = `plot-${i}`;
                plotDiv.onclick = () => handlePlotClick(i);
                
                const content = document.createElement('div');
                content.className = 'plot-content';
                
                const icon = document.createElement('div');
                icon.className = 'plot-icon';
                icon.textContent = plot.icon;
                
                const stats = document.createElement('div');
                stats.className = 'plot-stats';
                stats.innerHTML = `O:${plot.organic}% M:${plot.microbes}%`;
                
                content.appendChild(icon);
                content.appendChild(stats);
                plotDiv.appendChild(content);
                grid.appendChild(plotDiv);
                
                updatePlotAppearance(i);
            });
        }

        // Update Single Plot
        function updatePlot(plotId) {
            const plot = gameState.plots[plotId];
            const plotDiv = document.getElementById(`plot-${plotId}`);
            if (!plotDiv) return;

            const icon = plotDiv.querySelector('.plot-icon');
            const stats = plotDiv.querySelector('.plot-stats');
            
            icon.textContent = plot.icon;
            stats.innerHTML = `O:${plot.organic}% M:${plot.microbes}%`;
            
            updatePlotAppearance(plotId);
        }

        // Update Plot Visual Appearance
        function updatePlotAppearance(plotId) {
            const plot = gameState.plots[plotId];
            const plotDiv = document.getElementById(`plot-${plotId}`);
            if (!plotDiv) return;

            // Remove all special classes
            plotDiv.classList.remove('healthy', 'ready-to-harvest');
            
            // Check if plot is ready to harvest
            if (plot.state === 'planted' && isReadyToHarvest(plotId)) {
                plotDiv.classList.add('ready-to-harvest');
            }
            // Check if plot is healthy
            else if (plot.organic >= 50 && plot.microbes >= 40 && plot.moisture >= 30) {
                plotDiv.classList.add('healthy');
            }
        }

        // Handle Plot Click
        function handlePlotClick(plotId) {
            const plot = gameState.plots[plotId];
            
            if (plot.state === 'empty') {
                plantCrop(plotId);
            } else if (plot.state === 'planted' && isReadyToHarvest(plotId)) {
                harvest(plotId);
            } else if (plot.state === 'coverCrop') {
                showMessage('Cover crop is enriching the soil!', 'info');
            } else if (plot.state === 'planted') {
                const stageNames = ['', 'seedling', 'growing', 'mature'];
                const stageName = stageNames[plot.growthStage] || 'growing';
                showMessage(`Crop is still growing (${stageName} stage)`, 'info');
            }
        }

        // Plant Crop
        function plantCrop(plotId) {
            if (gameState.money < 20) {
                showMessage('Not enough money to plant! Need $20', 'error');
                return;
            }

            const plot = gameState.plots[plotId];
            gameState.money -= 20;
            plot.state = 'planted';
            plot.growthStage = GROWTH_STAGES.SEEDLING;
            plot.icon = plotIcons.seedling;
            
            createParticle('üå±', plotId);
            vibrate(50);
            
            updatePlot(plotId);
            updateUI();
        }

        // Check if crop is ready to harvest
        function isReadyToHarvest(plotId) {
            const plot = gameState.plots[plotId];
            // Fixed detection: crop must be planted, at mature stage, and have adequate organic matter
            return plot.state === 'planted' && 
                   plot.growthStage >= GROWTH_STAGES.MATURE && 
                   plot.organic >= 50;
        }

        // Harvest Plot
        function harvest(plotId) {
            const plot = gameState.plots[plotId];
            
            if (!isReadyToHarvest(plotId)) {
                showMessage('Crop is not ready to harvest yet!', 'error');
                return;
            }

            const quality = Math.floor((plot.organic + plot.microbes + plot.moisture) / 3);
            const earnings = Math.floor(quality * 2);
            const carbonEarned = Math.floor(quality / 10);

            gameState.money += earnings;
            gameState.crops += 1;
            gameState.carbon += carbonEarned;
            gameState.carbonScore += carbonEarned;

            createParticle(`+$${earnings}`, plotId);
            vibrate(100);

            // Reset plot
            plot.state = 'empty';
            plot.growthStage = 0;
            plot.icon = plotIcons.empty;
            plot.organic = Math.max(30, plot.organic - 20);
            plot.moisture = Math.max(10, plot.moisture - 15);

            updatePlot(plotId);
            updateUI();
        }

        // Apply Compost (Global Action)
        function applyCompost() {
            if (gameState.money < 50) {
                showMessage('Not enough money! Need $50', 'error');
                return;
            }

            gameState.money -= 50;
            gameState.organicMatter = Math.min(100, gameState.organicMatter + 15);
            
            gameState.plots.forEach((plot, i) => {
                plot.organic = Math.min(100, plot.organic + 15);
                updatePlot(i);
            });

            vibrate(100);
            updateUI();
            showMessage('Compost applied! Organic matter increased!', 'success');
        }

        // Plant Cover Crop (Global Action)
        function plantCoverCrop() {
            if (gameState.money < 30) {
                showMessage('Not enough money! Need $30', 'error');
                return;
            }

            const emptyPlots = gameState.plots.filter(p => p.state === 'empty');
            if (emptyPlots.length === 0) {
                showMessage('No empty plots available!', 'error');
                return;
            }

            gameState.money -= 30;
            gameState.microbes = Math.min(100, gameState.microbes + 10);

            gameState.plots.forEach((plot, i) => {
                if (plot.state === 'empty') {
                    plot.state = 'coverCrop';
                    plot.icon = plotIcons.coverCrop;
                    plot.microbes = Math.min(100, plot.microbes + 20);
                    plot.organic = Math.min(100, plot.organic + 10);
                    updatePlot(i);
                }
            });

            vibrate(100);
            updateUI();
            showMessage('Cover crops planted! Soil microbes boosted!', 'success');
        }

        // Irrigate (Global Action)
        function irrigate() {
            if (gameState.money < 40) {
                showMessage('Not enough money! Need $40', 'error');
                return;
            }

            gameState.money -= 40;
            gameState.moisture = Math.min(100, gameState.moisture + 20);

            gameState.plots.forEach((plot, i) => {
                plot.moisture = Math.min(100, plot.moisture + 25);
                updatePlot(i);
            });

            vibrate(100);
            updateUI();
            showMessage('Irrigation complete! All plots watered!', 'success');
        }

        // Update Global Stats
        function updateGlobalStats() {
            // Average plot stats
            const totalPlots = gameState.plots.length;
            gameState.organicMatter = gameState.plots.reduce((sum, p) => sum + p.organic, 0) / totalPlots;
            gameState.microbes = gameState.plots.reduce((sum, p) => sum + p.microbes, 0) / totalPlots;
            gameState.moisture = gameState.plots.reduce((sum, p) => sum + p.moisture, 0) / totalPlots;

            // Count healthy plots
            gameState.healthyPlots = gameState.plots.filter(p => 
                p.organic >= 50 && p.microbes >= 40 && p.moisture >= 30
            ).length;
        }

        // Update UI
        function updateUI() {
            updateGlobalStats();

            document.getElementById('money').textContent = `$${gameState.money}`;
            document.getElementById('crops').textContent = gameState.crops;
            document.getElementById('carbon').textContent = gameState.carbon;

            // Cap global stats
            gameState.organicMatter = Math.min(gameState.organicMatter, 100);
            gameState.microbes = Math.min(gameState.microbes, 100);
            gameState.moisture = Math.min(gameState.moisture, 100);
            gameState.carbonScore = Math.min(gameState.carbonScore, 100);

            document.getElementById('organic-val').textContent = `${Math.floor(gameState.organicMatter)}%`;
            document.getElementById('organic-bar').style.width = `${gameState.organicMatter}%`;

            document.getElementById('microbes-val').textContent = `${Math.floor(gameState.microbes)}%`;
            document.getElementById('microbes-bar').style.width = `${gameState.microbes}%`;

            document.getElementById('moisture-val').textContent = `${Math.floor(gameState.moisture)}%`;
            document.getElementById('moisture-bar').style.width = `${gameState.moisture}%`;

            document.getElementById('carbon-val').textContent = Math.floor(gameState.carbonScore);
            document.getElementById('carbon-bar').style.width = `${gameState.carbonScore}%`;

            document.getElementById('healthy-plots').textContent = gameState.healthyPlots;

            // Biodiversity
            const avgHealth = (gameState.organicMatter + gameState.microbes + gameState.moisture) / 3;
            let biodiversity = 'Low';
            if (avgHealth >= 70) biodiversity = 'High';
            else if (avgHealth >= 40) biodiversity = 'Medium';
            document.getElementById('biodiversity').textContent = biodiversity;
        }

        // Season Cycle
        function startSeasonCycle() {
            gameState.seasonTimer = setInterval(() => {
                advanceSeason();
            }, 30000); // 30 seconds per season
        }

        function advanceSeason() {
            gameState.season = (gameState.season + 1) % 4;
            document.getElementById('season').textContent = seasons[gameState.season];

            // Grow plants
            gameState.plots.forEach((plot, i) => {
                if (plot.state === 'planted') {
                    // Increment growth stage with cap at MATURE
                    if (plot.growthStage < GROWTH_STAGES.MAX) {
                        plot.growthStage++;
                        
                        // Bonus growth if well-watered
                        if (plot.moisture > 60 && plot.growthStage < GROWTH_STAGES.MAX) {
                            plot.growthStage++;
                        }
                        
                        // Cap at maximum stage
                        plot.growthStage = Math.min(plot.growthStage, GROWTH_STAGES.MAX);
                        
                        // Update icon based on growth stage
                        if (plot.growthStage === GROWTH_STAGES.SEEDLING) {
                            plot.icon = plotIcons.seedling;
                        } else if (plot.growthStage === GROWTH_STAGES.GROWING) {
                            plot.icon = plotIcons.growing;
                        } else if (plot.growthStage >= GROWTH_STAGES.MATURE) {
                            plot.icon = plotIcons.mature;
                        }
                    }
                    
                    updatePlot(i);
                }
                
                // Natural moisture loss
                plot.moisture = Math.max(0, plot.moisture - 5);
                
                // Cover crops improve soil over time
                if (plot.state === 'coverCrop') {
                    plot.organic = Math.min(100, plot.organic + 5);
                    plot.microbes = Math.min(100, plot.microbes + 5);
                }
            });

            // Random climate events
            if (Math.random() < 0.3) {
                triggerClimateEvent();
            }

            // Natural carbon sequestration
            if (gameState.healthyPlots > 3) {
                gameState.carbonScore += gameState.healthyPlots;
                gameState.carbon += Math.floor(gameState.healthyPlots / 2);
            }

            updateUI();
        }

        // Climate Events
        function triggerClimateEvent() {
            const events = [
                {
                    title: 'üî• Heatwave!',
                    description: 'A severe heatwave is testing your soil moisture. Plots with low moisture are suffering!',
                    effect: () => {
                        gameState.plots.forEach((plot, i) => {
                            if (plot.moisture < 30) {
                                plot.organic = Math.max(0, plot.organic - 15);
                                plot.moisture = Math.max(0, plot.moisture - 20);
                            }
                            updatePlot(i);
                        });
                        gameState.moisture = Math.max(0, gameState.moisture - 10);
                    }
                },
                {
                    title: 'üåä Heavy Rainfall!',
                    description: 'Intense rain is flooding the fields. Healthy soil absorbs it, poor soil loses nutrients!',
                    effect: () => {
                        gameState.plots.forEach((plot, i) => {
                            if (plot.organic < 30) {
                                plot.organic = Math.max(0, plot.organic - 10);
                                plot.microbes = Math.max(0, plot.microbes - 10);
                            } else {
                                plot.moisture = Math.min(100, plot.moisture + 20);
                            }
                            updatePlot(i);
                        });
                        gameState.moisture += 15;
                    }
                }
            ];

            const event = events[Math.floor(Math.random() * events.length)];
            showEvent(event.title, event.description);
            event.effect();
            vibrate(200);
            updateUI();
        }

        // Show Event
        function showEvent(title, description) {
            const panel = document.getElementById('events-panel');
            document.getElementById('event-title').textContent = title;
            document.getElementById('event-description').textContent = description;
            panel.style.display = 'block';
            setTimeout(() => {
                panel.style.display = 'none';
            }, 5000);
        }

        // Create Particle Effect
        function createParticle(text, plotId) {
            const plotDiv = document.getElementById(`plot-${plotId}`);
            const rect = plotDiv.getBoundingClientRect();
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = text;
            particle.style.left = `${rect.left + rect.width / 2}px`;
            particle.style.top = `${rect.top + rect.height / 2}px`;
            particle.style.fontSize = '24px';
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 2000);
        }

        // Vibrate (mobile)
        function vibrate(duration) {
            if (navigator.vibrate) {
                navigator.vibrate(duration);
            }
        }

        // Show Message
        function showMessage(msg, type) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'error' ? '#c44536' : type === 'success' ? '#4a7c59' : '#4a90a4'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1000;
                animation: slideUp 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Start Game
        function startGame() {
            document.getElementById('tutorial').style.display = 'none';
            initGame();
        }

        // Mobile Sidebar Toggle
        let sidebarOpen = false;
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                if (e.target.closest('.resource')) {
                    sidebarOpen = !sidebarOpen;
                    sidebar.classList.toggle('open', sidebarOpen);
                } else if (!e.target.closest('#sidebar') && sidebarOpen) {
                    sidebarOpen = false;
                    sidebar.classList.remove('open');
                }
            }
        });

        // Auto-save
        setInterval(() => {
            localStorage.setItem('groundskeeper-save', JSON.stringify(gameState));
        }, 10000);

        // Load save on start
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('groundskeeper-save');
            if (saved) {
                // Could implement load functionality here
            }
        });
    </script>
</body>
</html>
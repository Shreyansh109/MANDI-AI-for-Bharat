<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Market-to-Fork - Supply Chain Management</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght:400;700;900&family=Rajdhani:wght:300;400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #121829;
            --bg-card: #1a2235;
            --accent-cyan: #00f0ff;
            --accent-green: #00ff88;
            --accent-orange: #ff6b35;
            --accent-red: #ff3366;
            --text-primary: #e8f0f7;
            --text-secondary: #8b9dc3;
            --border-color: #2a3f5f;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 49px, rgba(0, 240, 255, 0.05) 50px),
                linear-gradient(0deg, transparent 49px, rgba(0, 240, 255, 0.05) 50px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 100%;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(0, 240, 255, 0.1) 100%);
            border-bottom: 2px solid var(--accent-cyan);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            box-shadow: 0 4px 20px rgba(0, 240, 255, 0.3);
        }
        
        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.2rem, 4vw, 2rem);
            font-weight: 900;
            background: linear-gradient(45deg, var(--accent-cyan), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 240, 255, 0.5);
            letter-spacing: 2px;
        }
        
        .stats {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid var(--accent-cyan);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: clamp(0.8rem, 2vw, 1rem);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(0, 240, 255, 0.4);
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85em;
        }
        
        .stat-value {
            color: var(--accent-green);
            font-weight: 700;
        }
        
        /* Main game area */
        .game-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            padding: 1rem;
        }
        
        @media (min-width: 1024px) {
            .game-grid {
                grid-template-columns: 350px 1fr 350px;
            }
        }
        
        /* Cards */
        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-cyan), transparent);
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Contracts */
        .contract-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .contract-card {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.05), rgba(0, 255, 136, 0.05));
            border: 1px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .contract-card:hover {
            transform: translateX(5px);
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }
        
        .contract-card.selected {
            border-color: var(--accent-cyan);
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.15), rgba(0, 255, 136, 0.05));
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }
        
        .contract-card.accepted {
            border-color: var(--accent-green);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 240, 255, 0.1));
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        
        .contract-card.dispatched {
            opacity: 0.4;
            pointer-events: none;
            border-color: var(--text-secondary);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
        }
        
        .contract-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--accent-green);
            color: var(--bg-primary);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
        }
        
        .contract-badge.dispatched {
            background: var(--text-secondary);
        }
        
        .contract-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .crop-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--accent-green);
        }
        
        .reward {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--accent-cyan);
        }
        
        .contract-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .freshness-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .freshness-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-orange));
            transition: width 1s linear;
        }
        
        /* Map */
        .map-container {
            position: relative;
            background: radial-gradient(circle at 30% 30%, rgba(0, 240, 255, 0.05), var(--bg-secondary));
            border-radius: 12px;
            overflow: hidden;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .map-svg {
            width: 100%;
            height: 100%;
            min-height: 400px;
        }
        
        .route-line {
            stroke: var(--accent-cyan);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 5, 5;
            animation: dashMove 1s linear infinite;
        }
        
        @keyframes dashMove {
            to { stroke-dashoffset: -10; }
        }
        
        .location-marker {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .location-marker:hover {
            filter: drop-shadow(0 0 10px var(--accent-cyan));
        }
        
        .vehicle {
            animation: vehicleMove 3s ease-in-out;
        }
        
        @keyframes vehicleMove {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(10px, -10px); }
        }
        
        /* Fleet panel */
        .fleet-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .fleet-item {
            background: rgba(0, 240, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .fleet-item.active {
            border-color: var(--accent-green);
            background: rgba(0, 255, 136, 0.1);
        }
        
        .fleet-item.busy {
            opacity: 0.5;
        }
        
        .fleet-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .fleet-status {
            font-size: 0.85rem;
            color: var(--accent-green);
            font-weight: 600;
        }
        
        .fleet-status.busy {
            color: var(--accent-orange);
        }
        
        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .btn {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-green));
            color: var(--bg-primary);
            box-shadow: 0 4px 15px rgba(0, 240, 255, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 240, 255, 0.6);
        }
        
        .btn-secondary {
            background: rgba(255, 107, 53, 0.2);
            color: var(--accent-orange);
            border: 1px solid var(--accent-orange);
        }
        
        .btn-secondary:hover {
            background: var(--accent-orange);
            color: var(--bg-primary);
        }
        
        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .btn:not(:disabled).pulse {
            animation: buttonPulse 2s ease-in-out infinite;
        }
        
        @keyframes buttonPulse {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(0, 240, 255, 0.4);
            }
            50% {
                box-shadow: 0 4px 25px rgba(0, 240, 255, 0.8);
            }
        }
        
        /* News feed */
        .news-feed {
            background: rgba(255, 107, 53, 0.1);
            border-left: 3px solid var(--accent-orange);
            padding: 0.75rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-size: 0.9rem;
            animation: newsPulse 2s ease-in-out infinite;
        }
        
        @keyframes newsPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .news-title {
            font-weight: 700;
            color: var(--accent-orange);
            margin-bottom: 0.25rem;
        }
        
        /* Upgrades */
        .upgrade-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .upgrade-card {
            background: rgba(0, 240, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upgrade-card:hover {
            border-color: var(--accent-cyan);
            transform: scale(1.05);
        }
        
        .upgrade-card.purchased {
            border-color: var(--accent-green);
            background: rgba(0, 255, 136, 0.1);
        }
        
        .upgrade-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .upgrade-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .upgrade-cost {
            color: var(--accent-cyan);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent-cyan);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-green);
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .header {
                padding: 0.75rem;
            }
            
            .game-grid {
                padding: 0.5rem;
                gap: 0.5rem;
            }
            
            .panel {
                padding: 0.75rem;
            }
            
            .contract-list {
                max-height: 300px;
            }
            
            .map-svg {
                min-height: 300px;
            }
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-card);
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: slideIn 0.3s ease-out, slideOut 0.3s ease-in 2.7s;
            font-weight: 600;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 240, 255, 0.3);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Manual/Guide Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border: 2px solid var(--accent-cyan);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 60px rgba(0, 240, 255, 0.5);
            animation: modalSlideIn 0.3s ease-out;
            position: relative;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: scale(0.8) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.2), rgba(0, 255, 136, 0.2));
            border-bottom: 2px solid var(--accent-cyan);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--accent-cyan), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .modal-close {
            background: rgba(255, 51, 102, 0.2);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: var(--accent-red);
            color: var(--bg-primary);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .guide-section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .guide-section:last-child {
            border-bottom: none;
        }
        
        .guide-section h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: var(--accent-cyan);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .guide-section h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--accent-green);
            margin: 1.5rem 0 0.75rem 0;
        }
        
        .guide-section p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 1rem;
        }
        
        .guide-list {
            list-style: none;
            padding-left: 0;
        }
        
        .guide-list li {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 0.75rem;
            padding-left: 1.5rem;
            position: relative;
        }
        
        .guide-list li::before {
            content: '‚ñ∏';
            color: var(--accent-cyan);
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .info-box {
            background: rgba(0, 240, 255, 0.1);
            border-left: 3px solid var(--accent-cyan);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .info-box.warning {
            background: rgba(255, 107, 53, 0.1);
            border-left-color: var(--accent-orange);
        }
        
        .info-box.success {
            background: rgba(0, 255, 136, 0.1);
            border-left-color: var(--accent-green);
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .stats-table th,
        .stats-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .stats-table th {
            background: rgba(0, 240, 255, 0.1);
            color: var(--accent-cyan);
            font-weight: 700;
        }
        
        .stats-table td {
            color: var(--text-secondary);
        }
        
        .help-btn {
            background: rgba(0, 240, 255, 0.2);
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .help-btn:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 240, 255, 0.4);
        }
        
        .keyboard-key {
            display: inline-block;
            background: rgba(0, 240, 255, 0.2);
            border: 1px solid var(--accent-cyan);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9em;
            margin: 0 0.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">MARKET-TO-FORK</div>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">Cash:</span>
                    <span class="stat-value">$<span id="cash">10000</span></span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Rating:</span>
                    <span class="stat-value"><span id="rating">3.0</span>‚òÖ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">CO‚ÇÇ Credits:</span>
                    <span class="stat-value"><span id="carbon">0</span></span>
                </div>
                <button class="help-btn" onclick="openManual()">üìñ MANUAL</button>
            </div>
        </header>
        
        <div class="game-grid">
            <!-- Left panel: Contracts -->
            <div class="panel">
                <div class="panel-title">üìã Available Contracts</div>
                <div class="contract-list" id="contractList"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="acceptBtn" disabled>Accept Contract</button>
                </div>
                
                <div id="workflowStatus" style="margin-top: 1rem; padding: 0.75rem; background: rgba(0, 240, 255, 0.05); border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.9rem; display: none;">
                    <div style="color: var(--accent-cyan); font-weight: 600; margin-bottom: 0.5rem;">üìã Workflow Status</div>
                    <div id="statusText" style="color: var(--text-secondary);"></div>
                </div>
            </div>
            
            <!-- Center panel: Map -->
            <div class="panel">
                <div class="panel-title">üó∫Ô∏è Regional Map</div>
                <div class="map-container">
                    <svg class="map-svg" id="mapSvg" viewBox="0 0 600 400">
                        <!-- Background -->
                        <defs>
                            <radialGradient id="mapGrad">
                                <stop offset="0%" style="stop-color:rgba(0,240,255,0.1);stop-opacity:1" />
                                <stop offset="100%" style="stop-color:rgba(18,24,41,1);stop-opacity:1" />
                            </radialGradient>
                        </defs>
                        <rect width="600" height="400" fill="url(#mapGrad)"/>
                        
                        <!-- Routes will be drawn here -->
                        <g id="routes"></g>
                        
                        <!-- Locations -->
                        <g id="locations">
                            <!-- Farms -->
                            <g class="location-marker" data-type="farm" data-x="100" data-y="100">
                                <circle cx="100" cy="100" r="15" fill="#00ff88" opacity="0.2"/>
                                <circle cx="100" cy="100" r="8" fill="#00ff88"/>
                                <text x="100" y="130" text-anchor="middle" fill="#00ff88" font-size="12">üåæ Farm A</text>
                            </g>
                            <g class="location-marker" data-type="farm" data-x="500" data-y="80">
                                <circle cx="500" cy="80" r="15" fill="#00ff88" opacity="0.2"/>
                                <circle cx="500" cy="80" r="8" fill="#00ff88"/>
                                <text x="500" y="110" text-anchor="middle" fill="#00ff88" font-size="12">ü•¨ Farm B</text>
                            </g>
                            
                            <!-- Warehouse -->
                            <g class="location-marker" data-type="warehouse" data-x="300" data-y="200">
                                <circle cx="300" cy="200" r="20" fill="#00f0ff" opacity="0.2"/>
                                <circle cx="300" cy="200" r="10" fill="#00f0ff"/>
                                <text x="300" y="235" text-anchor="middle" fill="#00f0ff" font-size="14" font-weight="bold">üè≠ HQ</text>
                            </g>
                            
                            <!-- Retailers -->
                            <g class="location-marker" data-type="retailer" data-x="150" data-y="320">
                                <circle cx="150" cy="320" r="15" fill="#ff6b35" opacity="0.2"/>
                                <circle cx="150" cy="320" r="8" fill="#ff6b35"/>
                                <text x="150" y="350" text-anchor="middle" fill="#ff6b35" font-size="12">üè™ Store 1</text>
                            </g>
                            <g class="location-marker" data-type="retailer" data-x="450" data-y="300">
                                <circle cx="450" cy="300" r="15" fill="#ff6b35" opacity="0.2"/>
                                <circle cx="450" cy="300" r="8" fill="#ff6b35"/>
                                <text x="450" y="330" text-anchor="middle" fill="#ff6b35" font-size="12">üçΩÔ∏è Restaurant</text>
                            </g>
                        </g>
                        
                        <!-- Vehicles will be drawn here -->
                        <g id="vehicles"></g>
                    </svg>
                </div>
                
                <div id="newsContainer"></div>
            </div>
            
            <!-- Right panel: Fleet & Upgrades -->
            <div class="panel">
                <div class="panel-title">üöõ Fleet Management</div>
                <div style="margin-bottom: 1rem; padding: 0.5rem; background: rgba(0, 240, 255, 0.05); border-radius: 4px; font-size: 0.9rem;">
                    <span style="color: var(--text-secondary);">Active Deliveries: </span>
                    <span style="color: var(--accent-green); font-weight: 700;" id="activeDeliveryCount">0</span>
                    <span style="color: var(--text-secondary);"> / 3</span>
                </div>
                <div class="fleet-list" id="fleetList"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="dispatchBtn" disabled>Dispatch</button>
                    <button class="btn btn-secondary" id="processBtn" disabled>Process</button>
                </div>
                
                <div class="panel-title" style="margin-top: 2rem;">‚ö° Upgrades</div>
                <div class="upgrade-grid" id="upgradeGrid"></div>
            </div>
        </div>
        
        <!-- Manual/Guide Modal -->
        <div class="modal-overlay" id="manualModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">üìñ PLAYER'S MANUAL</div>
                    <button class="modal-close" onclick="closeManual()">√ó</button>
                </div>
                <div class="modal-body">
                    <!-- Quick Start -->
                    <div class="guide-section">
                        <h2>üöÄ Quick Start Guide</h2>
                        <p>Welcome to Market-to-Fork! You're the CEO of a cutting-edge supply chain operation in 2026. Your mission: bridge the gap between farms and consumers while maintaining efficiency, quality, and sustainability.</p>
                        
                        <div class="info-box success">
                            <strong>üéØ Your Goal:</strong> Build a profitable logistics empire by accepting contracts, optimizing delivery routes, and upgrading your infrastructure. Balance the <strong>Golden Triangle</strong> of Efficiency, Quality, and Sustainability to succeed!
                        </div>
                        
                        <h3>Basic Workflow</h3>
                        <ul class="guide-list">
                            <li><strong>Step 1:</strong> Select a contract from the left panel (look for high rewards and manageable distances)</li>
                            <li><strong>Step 2:</strong> Choose an available vehicle from your fleet (match vehicle to cargo needs)</li>
                            <li><strong>Step 3:</strong> Optional - Click "Process" to convert raw goods for higher profits</li>
                            <li><strong>Step 4:</strong> Click "Dispatch" to send your vehicle on delivery</li>
                            <li><strong>Step 5:</strong> Watch the delivery progress on the map and collect your reward!</li>
                        </ul>
                    </div>
                    
                    <!-- Core Mechanics -->
                    <div class="guide-section">
                        <h2>‚öôÔ∏è Core Mechanics</h2>
                        
                        <h3>üçì Freshness & Perishability</h3>
                        <p>Every crop has a <strong>Freshness Value</strong> that decays over time using the formula: F(t) = 100 √ó e<sup>-kt</sup></p>
                        <ul class="guide-list">
                            <li><strong>Strawberries</strong> decay fastest - deliver quickly!</li>
                            <li><strong>Potatoes</strong> and <strong>Wheat</strong> last longer</li>
                            <li>Watch the green freshness bar below each contract</li>
                            <li>Higher freshness = higher reward when delivered</li>
                        </ul>
                        
                        <div class="info-box warning">
                            <strong>‚ö†Ô∏è Warning:</strong> If freshness drops below 50%, your rating will decrease! Late or spoiled deliveries hurt your reputation and limit access to premium contracts.
                        </div>
                        
                        <h3>‚≠ê Rating System (The "Fork" Rating)</h3>
                        <p>Your reputation score ranges from 1-5 stars:</p>
                        <ul class="guide-list">
                            <li><strong>High freshness (>80%)</strong> ‚Üí Rating increases</li>
                            <li><strong>Low freshness (<50%)</strong> ‚Üí Rating decreases significantly</li>
                            <li>Higher ratings unlock better contracts with premium buyers</li>
                            <li>Maintain 4+ stars to access high-end restaurants and retailers</li>
                        </ul>
                        
                        <h3>‚öôÔ∏è Processing for Profit</h3>
                        <p>Some raw goods can be processed into higher-value products:</p>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>Raw Material</th>
                                    <th>Processed Product</th>
                                    <th>Value Multiplier</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ü•õ Milk</td>
                                    <td>üßÄ Cheese</td>
                                    <td>1.5x base value</td>
                                </tr>
                                <tr>
                                    <td>üåæ Wheat</td>
                                    <td>üçû Flour</td>
                                    <td>1.5x base value</td>
                                </tr>
                            </tbody>
                        </table>
                        <p><strong>Tip:</strong> Processing takes time but significantly increases margins. With the Solar Processing Hub upgrade, this multiplier increases to 2.25x!</p>
                    </div>
                    
                    <!-- Fleet Management -->
                    <div class="guide-section">
                        <h2>üöõ Fleet Management</h2>
                        <p>Each vehicle has unique strengths and weaknesses:</p>
                        
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Speed</th>
                                    <th>Capacity</th>
                                    <th>Decay Rate</th>
                                    <th>Best For</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>üöõ Cryo-EV Truck</td>
                                    <td>0.7x (Slow)</td>
                                    <td>100kg</td>
                                    <td>0.3x (Excellent)</td>
                                    <td>Long distances, perishables, carbon credits</td>
                                </tr>
                                <tr>
                                    <td>üöê Refrigerated Van</td>
                                    <td>1.0x (Normal)</td>
                                    <td>50kg</td>
                                    <td>0.5x (Good)</td>
                                    <td>Balanced medium-range deliveries</td>
                                </tr>
                                <tr>
                                    <td>üöÅ Agri-Drone</td>
                                    <td>1.5x (Fast)</td>
                                    <td>20kg</td>
                                    <td>0.8x (Poor)</td>
                                    <td>Short urgent deliveries, bypassing traffic</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="info-box">
                            <strong>üí° Pro Tip:</strong> Match vehicle to cargo! Use the Cryo-EV for strawberries and milk (high decay), the drone for last-minute orders, and the van for everything else.
                        </div>
                    </div>
                    
                    <!-- Dynamic Events -->
                    <div class="guide-section">
                        <h2>üì∞ Dynamic Market Events</h2>
                        <p>Random news events trigger every 30 seconds, affecting your business:</p>
                        
                        <ul class="guide-list">
                            <li><strong>‚õΩ Fuel Spike in Europe</strong> - Increases logistics costs by 15%</li>
                            <li><strong>ü´ò Vegan Festival in Neo-Delhi</strong> - Organic soy demand up 40%, higher prices!</li>
                            <li><strong>üåßÔ∏è Monsoon Delay</strong> - Grain prices increase 25%</li>
                            <li><strong>üå°Ô∏è Heat Wave Warning</strong> - All perishables decay 30% faster</li>
                            <li><strong>üå± Green Subsidy Program</strong> - Bonus +50 carbon credits for EV use</li>
                        </ul>
                        
                        <p>Events last for 60 seconds. Adapt your strategy to capitalize on opportunities or mitigate threats!</p>
                    </div>
                    
                    <!-- Upgrades -->
                    <div class="guide-section">
                        <h2>‚ö° Upgrades & Infrastructure</h2>
                        <p>Invest in upgrades to gain competitive advantages:</p>
                        
                        <h3>‚ùÑÔ∏è Cold Chain Tech ($5,000)</h3>
                        <p>Reduces decay rate by 20% across all deliveries. Essential for perishables and long-distance routes.</p>
                        
                        <h3>‚òÄÔ∏è Solar Processing Hub ($8,000)</h3>
                        <p>Increases processing value multiplier by 1.5x. Turn milk into cheese for 2.25x the original value!</p>
                        
                        <h3>üîó Blockchain Traceability ($12,000)</h3>
                        <p>Adds a 30% "Transparency Bonus" to all deliveries. Premium buyers pay extra for verified supply chains.</p>
                        
                        <h3>üì¶ Micro-Fulfillment Center ($6,000)</h3>
                        <p>Increases fleet speed by 20%. Faster deliveries mean fresher goods and better ratings.</p>
                        
                        <div class="info-box success">
                            <strong>üéØ Upgrade Strategy:</strong> Start with Cold Chain Tech to reduce losses, then Blockchain for premium bonuses. Save Solar Hub for mid-game when you're processing regularly.
                        </div>
                    </div>
                    
                    <!-- Carbon Credits -->
                    <div class="guide-section">
                        <h2>üå± Carbon Credits & Sustainability</h2>
                        <p>In 2026, you're taxed on emissions. Using eco-friendly options earns tradeable credits:</p>
                        
                        <ul class="guide-list">
                            <li><strong>EV vehicles</strong> earn 1 credit per 10km traveled</li>
                            <li><strong>Optimized routes</strong> (10% shorter) earn bonus credits</li>
                            <li>Credits can be traded for cash or used to offset expansion costs</li>
                            <li>Green Subsidy events give +50 bonus credits</li>
                        </ul>
                        
                        <div class="info-box">
                            <strong>üí° Green is Good:</strong> Despite slower speed, the Cryo-EV Truck generates passive income through carbon credits while preserving freshness. Win-win!
                        </div>
                    </div>
                    
                    <!-- Advanced Strategies -->
                    <div class="guide-section">
                        <h2>üéì Advanced Strategies</h2>
                        
                        <h3>The Golden Triangle</h3>
                        <p>Success requires balancing three pillars:</p>
                        <ul class="guide-list">
                            <li><strong>Efficiency:</strong> Fast deliveries, optimized routes, high vehicle utilization</li>
                            <li><strong>Quality:</strong> Maintaining freshness above 80%, high ratings, premium buyers</li>
                            <li><strong>Sustainability:</strong> EV usage, carbon credits, green upgrades</li>
                        </ul>
                        
                        <h3>Contract Selection Tips</h3>
                        <ul class="guide-list">
                            <li>Higher decay crops (strawberries) should be paired with Cryo-EV or done quickly with drone</li>
                            <li>Long-distance contracts are worth more but risk spoilage</li>
                            <li>Process raw materials before dispatching for instant value boost</li>
                            <li>During price spike events, prioritize affected crops (e.g., soy during vegan festival)</li>
                        </ul>
                        
                        <h3>Fleet Optimization</h3>
                        <ul class="guide-list">
                            <li>Don't leave vehicles idle - accept multiple contracts and queue deliveries</li>
                            <li>Short contracts with drone, medium with van, long with EV truck</li>
                            <li>During heat waves, use ALL fast options to beat increased decay</li>
                        </ul>
                        
                        <div class="info-box warning">
                            <strong>‚ö†Ô∏è Common Mistakes:</strong>
                            <ul class="guide-list">
                                <li>Using the drone for long distances (decay ruins profit)</li>
                                <li>Ignoring freshness timers (spoiled goods tank your rating)</li>
                                <li>Not processing when available (leaving money on the table)</li>
                                <li>Buying upgrades too early (need cash flow first)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Technical Info -->
                    <div class="guide-section">
                        <h2>üñ•Ô∏è Technical Information</h2>
                        
                        <h3>Platform Compatibility</h3>
                        <ul class="guide-list">
                            <li><strong>PC/Desktop:</strong> Full 3-column layout with detailed stats</li>
                            <li><strong>Mobile/Tablet:</strong> Optimized single-column touch interface</li>
                            <li><strong>Browser:</strong> Works in all modern browsers (Chrome, Firefox, Safari, Edge)</li>
                        </ul>
                        
                        <h3>Controls</h3>
                        <ul class="guide-list">
                            <li><strong>Mouse/Touch:</strong> Click/tap on contracts and vehicles to select</li>
                            <li><strong>Buttons:</strong> Accept, Dispatch, and Process actions</li>
                            <li><strong>Upgrades:</strong> Click/tap upgrade cards to purchase</li>
                            <li><strong>Manual:</strong> Click üìñ MANUAL button anytime to view this guide</li>
                        </ul>
                        
                        <h3>Game Saves</h3>
                        <p>Currently, Market-to-Fork runs in your browser session. Your progress resets when you close or refresh the page. Play strategically to maximize your score in each session!</p>
                    </div>
                    
                    <!-- Tips & Tricks -->
                    <div class="guide-section">
                        <h2>üíé Pro Tips & Tricks</h2>
                        
                        <ul class="guide-list">
                            <li><strong>Watch the clock:</strong> Freshness decays in real-time. Don't let contracts sit too long!</li>
                            <li><strong>Process strategically:</strong> Processing adds no delivery time, so it's always worth it when available</li>
                            <li><strong>Carbon arbitrage:</strong> Long EV deliveries earn more credits than short ones - factor this into route selection</li>
                            <li><strong>Rating protection:</strong> If freshness is dropping, dispatch immediately even with slower vehicles</li>
                            <li><strong>Event timing:</strong> Save high-value contracts for beneficial events (price spikes, subsidies)</li>
                            <li><strong>Upgrade order matters:</strong> Cold Chain ‚Üí Blockchain ‚Üí Micro Center ‚Üí Solar Hub for optimal progression</li>
                            <li><strong>Vehicle rotation:</strong> Keep all three vehicles busy to maximize throughput</li>
                            <li><strong>Premium focus:</strong> Once you have 4+ stars, focus on high-value premium contracts</li>
                        </ul>
                        
                        <div class="info-box success">
                            <strong>üèÜ Ultimate Goal:</strong> Reach 5-star rating with $50,000+ cash and all upgrades purchased. This unlocks "Supply Chain Tycoon" status!
                        </div>
                    </div>
                    
                    <!-- Footer -->
                    <div class="guide-section">
                        <h2>üìû Need Help?</h2>
                        <p>Remember: The bridge between farm and table depends on YOU. Coordinate, process, deliver - before the clock runs out!</p>
                        <p style="text-align: center; margin-top: 2rem; color: var(--accent-cyan); font-family: 'Orbitron', sans-serif;">
                            <strong>Good luck, Supply Chain Manager! üöõüí®</strong>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Game State
        const gameState = {
            cash: 10000,
            rating: 3.0,
            carbonCredits: 0,
            selectedContract: null,
            acceptedContract: null,
            selectedFleet: null,
            activeDeliveries: [],
            contracts: [],
            fleet: [
                { id: 'ev1', name: 'Cryo-EV Truck', type: 'ev', speed: 0.7, capacity: 100, busy: false, decay: 0.3 },
                { id: 'van1', name: 'Refrigerated Van', type: 'van', speed: 1, capacity: 50, busy: false, decay: 0.5 },
                { id: 'drone1', name: 'Agri-Drone', type: 'drone', speed: 1.5, capacity: 20, busy: false, decay: 0.8 }
            ],
            upgrades: [
                { id: 'cold1', name: 'Cold Chain', cost: 5000, purchased: false, effect: 'decay', value: 0.2 },
                { id: 'solar1', name: 'Solar Hub', cost: 8000, purchased: false, effect: 'processing', value: 1.5 },
                { id: 'blockchain1', name: 'Blockchain', cost: 12000, purchased: false, effect: 'bonus', value: 0.3 },
                { id: 'micro1', name: 'Micro Center', cost: 6000, purchased: false, effect: 'speed', value: 1.2 }
            ],
            news: null,
            processingMultiplier: 1.0,
            decayReduction: 0,
            speedBonus: 1.0,
            transparencyBonus: 0
        };
        
        // Crop data
        const crops = [
            { name: 'Strawberries', icon: 'üçì', basePrice: 800, decay: 0.05, distance: 'short' },
            { name: 'Milk', icon: 'ü•õ', basePrice: 600, decay: 0.04, distance: 'medium', processable: 'Cheese' },
            { name: 'Wheat', icon: 'üåæ', basePrice: 400, decay: 0.01, distance: 'long', processable: 'Flour' },
            { name: 'Lettuce', icon: 'ü•¨', basePrice: 500, decay: 0.03, distance: 'short' },
            { name: 'Potatoes', icon: 'ü•î', basePrice: 350, decay: 0.02, distance: 'medium' },
            { name: 'Organic Soy', icon: 'ü´ò', basePrice: 700, decay: 0.02, distance: 'long' }
        ];
        
        // News events
        const newsEvents = [
            { title: 'Fuel Spike in Europe', effect: 'cost', value: 0.15, message: 'Logistics costs increased by 15%' },
            { title: 'Vegan Festival in Neo-Delhi', effect: 'demand', crop: 'Organic Soy', value: 0.4, message: 'Soy demand up 40%!' },
            { title: 'Monsoon Delay', effect: 'price', value: 0.25, message: 'Grain prices increased 25%' },
            { title: 'Heat Wave Warning', effect: 'decay', value: 1.3, message: 'Perishables spoiling faster!' },
            { title: 'Green Subsidy Program', effect: 'carbon', value: 50, message: 'Bonus carbon credits for EVs!' }
        ];
        
        // Initialize game
        function init() {
            generateContracts();
            renderContracts();
            renderFleet();
            renderUpgrades();
            updateUI();
            startGameLoop();
            
            // Random news event every 30 seconds
            setInterval(triggerNewsEvent, 30000);
        }
        
        // Generate random contracts
        function generateContracts() {
            gameState.contracts = [];
            for (let i = 0; i < 5; i++) {
                const crop = crops[Math.floor(Math.random() * crops.length)];
                const distance = Math.floor(Math.random() * 100) + 50;
                const deadline = Math.floor(Math.random() * 60) + 30; // 30-90 seconds
                const reward = Math.floor(crop.basePrice * (1 + distance / 100) * (gameState.news?.effect === 'price' ? 1.25 : 1));
                
                gameState.contracts.push({
                    id: 'c' + Date.now() + i,
                    crop: crop.name,
                    icon: crop.icon,
                    reward: reward,
                    distance: distance,
                    deadline: deadline,
                    freshness: 100,
                    decay: crop.decay,
                    processable: crop.processable,
                    createdAt: Date.now(),
                    status: 'available' // available, accepted, dispatched
                });
            }
        }
        
        // Render contracts
        function renderContracts() {
            const container = document.getElementById('contractList');
            container.innerHTML = gameState.contracts.map(contract => {
                let cardClass = 'contract-card';
                let badge = '';
                
                if (contract.status === 'dispatched') {
                    cardClass += ' dispatched';
                    badge = '<div class="contract-badge dispatched">IN TRANSIT</div>';
                } else if (contract.status === 'accepted') {
                    cardClass += ' accepted';
                    badge = '<div class="contract-badge">ACCEPTED</div>';
                } else if (gameState.selectedContract?.id === contract.id) {
                    cardClass += ' selected';
                }
                
                return `
                <div class="${cardClass}" 
                     onclick="selectContract('${contract.id}')">
                    ${badge}
                    <div class="contract-header">
                        <div class="crop-name">${contract.icon} ${contract.crop}</div>
                        <div class="reward">$${contract.reward}</div>
                    </div>
                    <div class="contract-details">
                        <div>üìç Distance: ${contract.distance}km</div>
                        <div>‚è±Ô∏è Deadline: ${contract.deadline}s</div>
                        ${contract.processable && contract.status !== 'dispatched' ? `<div>‚öôÔ∏è Process to ${contract.processable}</div>` : ''}
                    </div>
                    <div class="freshness-bar">
                        <div class="freshness-fill" style="width: ${contract.freshness}%"></div>
                    </div>
                </div>
            `;
            }).join('');
        }
        
        // Render fleet
        function renderFleet() {
            const container = document.getElementById('fleetList');
            container.innerHTML = gameState.fleet.map(vehicle => `
                <div class="fleet-item ${gameState.selectedFleet?.id === vehicle.id ? 'active' : ''} ${vehicle.busy ? 'busy' : ''}"
                     onclick="selectFleet('${vehicle.id}')">
                    <div>
                        <div class="fleet-name">${vehicle.name}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                            Capacity: ${vehicle.capacity}kg | Speed: ${vehicle.speed}x
                        </div>
                    </div>
                    <div class="fleet-status ${vehicle.busy ? 'busy' : ''}">
                        ${vehicle.busy ? 'BUSY' : 'READY'}
                    </div>
                </div>
            `).join('');
        }
        
        // Render upgrades
        function renderUpgrades() {
            const container = document.getElementById('upgradeGrid');
            const icons = { cold1: '‚ùÑÔ∏è', solar1: '‚òÄÔ∏è', blockchain1: 'üîó', micro1: 'üì¶' };
            
            container.innerHTML = gameState.upgrades.map(upgrade => `
                <div class="upgrade-card ${upgrade.purchased ? 'purchased' : ''}"
                     onclick="purchaseUpgrade('${upgrade.id}')">
                    <div class="upgrade-icon">${icons[upgrade.id]}</div>
                    <div class="upgrade-name">${upgrade.name}</div>
                    <div class="upgrade-cost">${upgrade.purchased ? '‚úì OWNED' : '$' + upgrade.cost}</div>
                </div>
            `).join('');
        }
        
        // Select contract
        function selectContract(id) {
            const contract = gameState.contracts.find(c => c.id === id);
            // Can only select available or accepted contracts
            if (contract && contract.status !== 'dispatched') {
                gameState.selectedContract = contract;
                renderContracts();
                updateButtons();
            }
        }
        
        // Select fleet
        function selectFleet(id) {
            const vehicle = gameState.fleet.find(v => v.id === id);
            if (!vehicle.busy) {
                gameState.selectedFleet = vehicle;
                renderFleet();
                updateButtons();
            }
        }
        
        // Update button states
        function updateButtons() {
            const hasSelected = gameState.selectedContract !== null;
            const isAccepted = gameState.selectedContract?.status === 'accepted';
            const hasFleet = gameState.selectedFleet !== null && !gameState.selectedFleet.busy;
            const canProcess = gameState.selectedContract?.processable && gameState.selectedContract?.status !== 'dispatched';
            
            const acceptBtn = document.getElementById('acceptBtn');
            const dispatchBtn = document.getElementById('dispatchBtn');
            const processBtn = document.getElementById('processBtn');
            
            // Accept button: enabled only for available contracts
            const canAccept = hasSelected && gameState.selectedContract?.status === 'available';
            acceptBtn.disabled = !canAccept;
            acceptBtn.classList.toggle('pulse', canAccept);
            
            // Dispatch button: enabled only for accepted contracts with selected fleet
            const canDispatch = isAccepted && hasFleet;
            dispatchBtn.disabled = !canDispatch;
            dispatchBtn.classList.toggle('pulse', canDispatch);
            
            // Process button: enabled for contracts that can be processed
            processBtn.disabled = !canProcess;
            processBtn.classList.toggle('pulse', canProcess);
            
            // Update workflow status
            updateWorkflowStatus();
        }
        
        // Update workflow status indicator
        function updateWorkflowStatus() {
            const statusContainer = document.getElementById('workflowStatus');
            const statusText = document.getElementById('statusText');
            
            if (!gameState.selectedContract) {
                statusContainer.style.display = 'none';
                return;
            }
            
            statusContainer.style.display = 'block';
            
            if (gameState.selectedContract.status === 'available') {
                statusText.innerHTML = `
                    <div style="margin-bottom: 0.5rem;">‚úì Contract Selected: ${gameState.selectedContract.crop}</div>
                    <div style="color: var(--accent-cyan);">‚Üí Next: Click "Accept Contract" button</div>
                `;
            } else if (gameState.selectedContract.status === 'accepted') {
                if (!gameState.selectedFleet) {
                    statusText.innerHTML = `
                        <div style="margin-bottom: 0.5rem;">‚úì Contract Accepted</div>
                        <div style="color: var(--accent-cyan);">‚Üí Next: Select a vehicle from the fleet</div>
                    `;
                } else {
                    statusText.innerHTML = `
                        <div style="margin-bottom: 0.5rem;">‚úì Contract Accepted</div>
                        <div style="margin-bottom: 0.5rem;">‚úì Vehicle Selected: ${gameState.selectedFleet.name}</div>
                        <div style="color: var(--accent-green);">‚Üí Ready: Click "Dispatch" to begin delivery!</div>
                    `;
                }
            } else if (gameState.selectedContract.status === 'dispatched') {
                statusText.innerHTML = `
                    <div style="color: var(--accent-orange);">üöõ In Transit...</div>
                `;
            }
        }
        
        // Accept contract
        document.getElementById('acceptBtn').onclick = () => {
            if (gameState.selectedContract && gameState.selectedContract.status === 'available') {
                gameState.selectedContract.status = 'accepted';
                gameState.acceptedContract = gameState.selectedContract;
                showToast(`‚úÖ Contract accepted: ${gameState.selectedContract.crop} - Now select a vehicle to dispatch!`);
                renderContracts();
                updateButtons();
            }
        };
        
        // Dispatch vehicle
        document.getElementById('dispatchBtn').onclick = () => {
            if (gameState.selectedContract && 
                gameState.selectedContract.status === 'accepted' && 
                gameState.selectedFleet && 
                !gameState.selectedFleet.busy) {
                dispatch();
            }
        };
        
        // Process goods
        document.getElementById('processBtn').onclick = () => {
            if (gameState.selectedContract && 
                gameState.selectedContract.processable && 
                gameState.selectedContract.status !== 'dispatched') {
                const oldReward = gameState.selectedContract.reward;
                gameState.selectedContract.reward = Math.floor(oldReward * gameState.processingMultiplier * 1.5);
                gameState.selectedContract.crop = gameState.selectedContract.processable;
                gameState.selectedContract.icon = gameState.selectedContract.processable === 'Cheese' ? 'üßÄ' : 'üçû';
                gameState.selectedContract.processable = null;
                
                renderContracts();
                showToast(`‚öôÔ∏è Processed! Value increased to $${gameState.selectedContract.reward}`);
                updateButtons();
            }
        };
        
        // Dispatch delivery
        function dispatch() {
            const contract = gameState.selectedContract;
            const vehicle = gameState.selectedFleet;
            
            // Mark contract as dispatched
            contract.status = 'dispatched';
            vehicle.busy = true;
            
            const travelTime = (contract.distance / (vehicle.speed * gameState.speedBonus)) * 1000; // Convert to ms
            const effectiveDecay = contract.decay * (1 - vehicle.decay + gameState.decayReduction);
            
            // Create delivery
            const delivery = {
                contract: contract,
                vehicle: vehicle,
                startTime: Date.now(),
                duration: travelTime,
                decay: effectiveDecay
            };
            
            gameState.activeDeliveries.push(delivery);
            
            // Draw route on map
            drawRoute(vehicle.id, contract);
            
            // Complete delivery after travel time
            setTimeout(() => completeDelivery(delivery), travelTime);
            
            showToast(`üöõ ${vehicle.name} dispatched with ${contract.crop}!`);
            
            // Clear selection
            gameState.selectedContract = null;
            gameState.acceptedContract = null;
            gameState.selectedFleet = null;
            
            renderContracts();
            renderFleet();
            updateButtons();
            updateUI();
        }
        
        // Complete delivery
        function completeDelivery(delivery) {
            const contract = delivery.contract;
            const vehicle = delivery.vehicle;
            
            // Calculate final freshness
            const timeElapsed = (Date.now() - delivery.startTime) / 1000;
            const finalFreshness = contract.freshness * Math.exp(-delivery.decay * timeElapsed);
            
            // Calculate reward
            let reward = Math.floor(contract.reward * (finalFreshness / 100));
            
            // Apply transparency bonus if blockchain purchased
            if (gameState.upgrades.find(u => u.id === 'blockchain1').purchased) {
                reward = Math.floor(reward * (1 + gameState.transparencyBonus + 0.3));
            }
            
            // Calculate carbon credits for EVs
            let carbonEarned = 0;
            if (vehicle.type === 'ev') {
                carbonEarned = Math.floor(contract.distance / 10);
            }
            
            // Update game state
            gameState.cash += reward;
            gameState.carbonCredits += carbonEarned;
            
            // Update rating based on freshness
            if (finalFreshness > 80) {
                gameState.rating = Math.min(5, gameState.rating + 0.1);
            } else if (finalFreshness < 50) {
                gameState.rating = Math.max(1, gameState.rating - 0.2);
            }
            
            // Free up vehicle
            vehicle.busy = false;
            
            // Remove contract
            gameState.contracts = gameState.contracts.filter(c => c.id !== contract.id);
            
            // Remove delivery
            gameState.activeDeliveries = gameState.activeDeliveries.filter(d => d !== delivery);
            
            // Add new contract
            if (gameState.contracts.length < 5) {
                const crop = crops[Math.floor(Math.random() * crops.length)];
                const distance = Math.floor(Math.random() * 100) + 50;
                const deadline = Math.floor(Math.random() * 60) + 30;
                const newReward = Math.floor(crop.basePrice * (1 + distance / 100));
                
                gameState.contracts.push({
                    id: 'c' + Date.now(),
                    crop: crop.name,
                    icon: crop.icon,
                    reward: newReward,
                    distance: distance,
                    deadline: deadline,
                    freshness: 100,
                    decay: crop.decay,
                    processable: crop.processable,
                    createdAt: Date.now(),
                    status: 'available'
                });
            }
            
            showToast(`‚úÖ Delivery complete! Earned $${reward} ${carbonEarned > 0 ? `+ ${carbonEarned} CO‚ÇÇ credits` : ''}`);
            
            renderContracts();
            renderFleet();
            updateUI();
            clearRoute(vehicle.id);
        }
        
        // Draw route on map
        function drawRoute(vehicleId, contract) {
            const routes = document.getElementById('routes');
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('class', 'route-line');
            path.setAttribute('id', `route-${vehicleId}`);
            path.setAttribute('d', 'M 100 100 L 300 200 L 450 300');
            routes.appendChild(path);
            
            // Add vehicle marker
            const vehicles = document.getElementById('vehicles');
            const vehicleIcon = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            vehicleIcon.setAttribute('id', `vehicle-${vehicleId}`);
            vehicleIcon.setAttribute('x', '100');
            vehicleIcon.setAttribute('y', '100');
            vehicleIcon.setAttribute('font-size', '24');
            vehicleIcon.setAttribute('class', 'vehicle');
            vehicleIcon.textContent = 'üöõ';
            vehicles.appendChild(vehicleIcon);
            
            // Animate vehicle
            let progress = 0;
            const animInterval = setInterval(() => {
                progress += 0.01;
                if (progress >= 1) {
                    clearInterval(animInterval);
                    return;
                }
                const x = 100 + (350 * progress);
                const y = 100 + (200 * progress);
                vehicleIcon.setAttribute('x', x);
                vehicleIcon.setAttribute('y', y);
            }, 50);
        }
        
        // Clear route
        function clearRoute(vehicleId) {
            const route = document.getElementById(`route-${vehicleId}`);
            const vehicle = document.getElementById(`vehicle-${vehicleId}`);
            if (route) route.remove();
            if (vehicle) vehicle.remove();
        }
        
        // Purchase upgrade
        function purchaseUpgrade(id) {
            const upgrade = gameState.upgrades.find(u => u.id === id);
            if (!upgrade.purchased && gameState.cash >= upgrade.cost) {
                gameState.cash -= upgrade.cost;
                upgrade.purchased = true;
                
                // Apply upgrade effect
                switch (upgrade.effect) {
                    case 'decay':
                        gameState.decayReduction += upgrade.value;
                        break;
                    case 'processing':
                        gameState.processingMultiplier *= upgrade.value;
                        break;
                    case 'bonus':
                        gameState.transparencyBonus += upgrade.value;
                        break;
                    case 'speed':
                        gameState.speedBonus *= upgrade.value;
                        break;
                }
                
                showToast(`‚ö° Upgrade purchased: ${upgrade.name}!`);
                renderUpgrades();
                updateUI();
            } else if (upgrade.purchased) {
                showToast('Already owned!');
            } else {
                showToast('Not enough cash!');
            }
        }
        
        // Trigger random news event
        function triggerNewsEvent() {
            const event = newsEvents[Math.floor(Math.random() * newsEvents.length)];
            gameState.news = event;
            
            const newsContainer = document.getElementById('newsContainer');
            newsContainer.innerHTML = `
                <div class="news-feed">
                    <div class="news-title">üì∞ ${event.title}</div>
                    <div>${event.message}</div>
                </div>
            `;
            
            showToast(`üì∞ Breaking: ${event.title}`);
            
            // Clear news after 1 minute
            setTimeout(() => {
                gameState.news = null;
                newsContainer.innerHTML = '';
            }, 60000);
        }
        
        // Game loop - update freshness
        function startGameLoop() {
            setInterval(() => {
                gameState.contracts.forEach(contract => {
                    // Only update freshness for non-dispatched contracts
                    if (contract.status !== 'dispatched') {
                        const age = (Date.now() - contract.createdAt) / 1000;
                        contract.freshness = Math.max(0, 100 * Math.exp(-contract.decay * age));
                    }
                });
                renderContracts();
            }, 1000);
        }
        
        // Update UI
        function updateUI() {
            document.getElementById('cash').textContent = gameState.cash;
            document.getElementById('rating').textContent = gameState.rating.toFixed(1);
            document.getElementById('carbon').textContent = gameState.carbonCredits;
            document.getElementById('activeDeliveryCount').textContent = gameState.activeDeliveries.length;
        }
        
        // Show toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Initialize on load
        init();
        
        // Manual/Guide functions
        function openManual() {
            document.getElementById('manualModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeManual() {
            document.getElementById('manualModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // Close modal when clicking outside
        document.getElementById('manualModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeManual();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeManual();
            }
        });
    </script>
</body>
</html>